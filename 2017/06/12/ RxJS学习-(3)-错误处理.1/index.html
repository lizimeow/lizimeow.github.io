<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="lizimeow"><title>RxJS å­¦ä¹ -(3)-é”™è¯¯å¤„ç† Â· lizimeow's blog</title><meta name="description" content="catchåœ¨ RxJS ä¸­çš„ catch èƒ½å¤Ÿå›ä¼ ä¸€ä¸ª observable æ¥é€å‡ºæ–°çš„å€¼
ç›´æ¥çœ‹ğŸŒ°:
å½“é”™è¯¯å‘ç”Ÿåå°±ä¼š catch å¹¶é‡æ–°å¤„ç†ä¸€ä¸ªæ–°çš„ observable æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–°çš„ observable æ¥é€å‡ºæˆ‘ä»¬æƒ³é€çš„å€¼
1234567891011const source = R"><meta name="keywords" content="lizimeow blog hexo JavaScript"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">lizimeow's blog</a></h3><div class="description"><p>A Web developer, Nice to meet you :)</p></div></div></div><ul class="social-links"><li><a href="http://weibo.com/lizimeow"><i class="fa fa-weibo"></i></a></li><li><a href="http://github.com/lizimeow"><i class="fa fa-github"></i></a></li></ul><div class="footer"><a target="_blank" href="/"><span>Theme by </span></a><a href="https://www.caicai.me"> CaiCai </a><span>&</span><a href="https://github.com/Ben02/hexo-theme-Anatole"> Ben</a><div class="by_farbox"><a href="https://hexo.io/zh-cn/" target="_blank">Proudly published with Hexo&#65281;</a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">Home</a></li><li><a href="/archives">Archive</a></li><li><a href="/links">Links</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>RxJS å­¦ä¹ -(3)-é”™è¯¯å¤„ç†</a></h3></div><div class="post-content"><h3 id="catch"><a href="#catch" class="headerlink" title="catch"></a>catch</h3><p>åœ¨ RxJS ä¸­çš„ catch èƒ½å¤Ÿå›ä¼ ä¸€ä¸ª observable æ¥é€å‡ºæ–°çš„å€¼</p>
<p>ç›´æ¥çœ‹ğŸŒ°:</p>
<p>å½“é”™è¯¯å‘ç”Ÿåå°±ä¼š catch å¹¶é‡æ–°å¤„ç†ä¸€ä¸ªæ–°çš„ observable æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–°çš„ observable æ¥é€å‡ºæˆ‘ä»¬æƒ³é€çš„å€¼</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source = Rx.observable.from([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="number">2</span>])</span><br><span class="line">				.zip(Rx.Observable.interval(<span class="number">500</span>), (x, y) =&gt; x)</span><br><span class="line"><span class="keyword">const</span> example = source</span><br><span class="line">				.map(<span class="function"><span class="params">x</span> =&gt;</span> x.toUpperCase())</span><br><span class="line">				.catch(<span class="function"><span class="params">err</span> =&gt;</span> Rx.Observable.of(<span class="string">'h'</span>))</span><br><span class="line">example.subscribe(&#123;</span><br><span class="line">    next: <span class="function"><span class="params">value</span> =&gt;</span> <span class="built_in">console</span>.log(value),</span><br><span class="line">  	error: <span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err),</span><br><span class="line">  	complete: <span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'complete!'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// A B C D h complete!</span></span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥åœ¨é‡åˆ°é”™è¯¯å, è®© observable ç»“æŸ, å¦‚ä¸‹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source = Rx.observable.from([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="number">2</span>, <span class="string">'d'</span>, <span class="number">2</span>])</span><br><span class="line">				.zip(Rx.Observable.interval(<span class="number">500</span>), (x, y) =&gt; x)</span><br><span class="line"><span class="keyword">const</span> example = source</span><br><span class="line">				.map(<span class="function"><span class="params">x</span> =&gt;</span> x.toUpperCase())</span><br><span class="line">				.catch(<span class="function"><span class="params">err</span> =&gt;</span> Rx.Observable.empty())</span><br><span class="line"><span class="comment">// A B complete!</span></span><br></pre></td></tr></table></figure>
<p>catch çš„ç¬¬äºŒä¸ªå‚æ•°æ¥æ”¶çš„æ˜¯å½“å‰çš„ observable</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source = Rx.observable.from([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="number">2</span>, <span class="string">'d'</span>, <span class="number">2</span>])</span><br><span class="line">				.zip(Rx.Observable.interval(<span class="number">500</span>), (x, y) =&gt; x)</span><br><span class="line"><span class="keyword">const</span> example = source</span><br><span class="line">				.map(<span class="function"><span class="params">x</span> =&gt;</span> x.toUpperCase())</span><br><span class="line">				.catch(<span class="function">(<span class="params">err, obs</span>) =&gt;</span> obs)</span><br><span class="line"><span class="comment">// A B A B A B A B...</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç›´æ¥å›ä¼ äº†å½“å‰çš„ observable ,ä¹Ÿå°±æ˜¯ example æ¥é‡æ–°æ‰§è¡Œ</p>
<p>å› ä¸ºåªæ˜¯ç®€å•çš„ç¤ºèŒƒ,  æ‰€ä»¥è¿™é‡Œä¼šä¸€ç›´æ— é™å¾ªç¯, é€šå¸¸ä¼šç”¨åœ¨<strong>æ–­çº¿é‡è¿</strong>çš„æƒ…æ™¯</p>
<p>ä¸Šé¢çš„å¤„ç†æ–¹å¼æœ‰ä¸€ä¸ªç®€åŒ–çš„å†™æ³•, å«åš <code>retry</code></p>
<h3 id="retry"><a href="#retry" class="headerlink" title="retry"></a>retry</h3><p>å¦‚æœæˆ‘ä»¬æƒ³è¦å®ç° å½“ observable å‘ç”Ÿé”™è¯¯æ—¶é‡æ–°å°è¯•å°±å¯ä»¥ç”¨ retry è¿™ä¸ªæ–¹æ³•</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source = Rx.Observable.from([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="number">2</span>])</span><br><span class="line">				.zip(Rx.Observable.interval(<span class="number">500</span>), (x, y) =&gt; x)</span><br><span class="line"><span class="keyword">const</span> example = source.map(<span class="function"><span class="params">v</span> =&gt;</span> v.toUpperCase()).retry()</span><br><span class="line">example.subscribe(&#123;</span><br><span class="line">    next: <span class="function"><span class="params">v</span> =&gt;</span> <span class="built_in">console</span>.log(v),</span><br><span class="line">  	error: <span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err),</span><br><span class="line">  	complete: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'complete'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// A B C D A B C D A B C D...</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾å®šåªå°è¯•å‡ æ¬¡, è­¬å¦‚<code>retry(1)</code></p>
<p>retry å¾ˆé€‚åˆç”¨åœ¨ HTTP request å¤±è´¥çš„åœºæ™¯ä¸­, æˆ‘ä»¬å¯ä»¥è®¾å®šé‡æ–°å‘é€å‡ æ¬¡ååœ¨å±•ç¤ºé”™è¯¯ä¿¡æ¯</p>
<h3 id="retryWhen"><a href="#retryWhen" class="headerlink" title="retryWhen"></a>retryWhen</h3><p>ä¸€èˆ¬æˆ‘ä»¬ä¼šä½¿ç”¨ retryWhen æ¥åšé”™è¯¯é€šçŸ¥æˆ–è€…æ„å¤–æ”¶é›†, ğŸŒ°å¦‚ä¸‹:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> source = Rx.Observable.from([<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="number">2</span>])</span><br><span class="line">				.zip(Rx.Observable.interval(<span class="number">500</span>), (x, y) =&gt; x)</span><br><span class="line"><span class="keyword">const</span> example = source.map(<span class="function"><span class="params">v</span> =&gt;</span> v.toUpperCase())</span><br><span class="line">				.retryWhen(<span class="function"><span class="params">errObs</span> =&gt;</span> errObs.map(<span class="function"><span class="params">err</span> =&gt;</span> fetch(<span class="string">'...'</span>)))</span><br><span class="line"><span class="comment">// example è®¢é˜…éƒ¨åˆ†çœç•¥..</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„<code>errObs =&gt; errObs.map(err =&gt; fetch(&#39;...&#39;))</code>å¯ä»¥æŠŠ errObs é‡Œçš„æ¯ä¸ªé”™è¯¯å˜æˆ api å‘é€.</p>
<blockquote>
<p>retryWhen å®é™…ä¸Šæ˜¯å»ºç«‹äº†ä¸€ä¸ª Subject å¹¶æŠŠé”™è¯¯æ”¾å…¥, ç„¶åå¯¹è¿™ä¸ª Subject è¿›è¡Œå†…éƒ¨çš„è®¢é˜…. è¿™ä¸ª Subject é¢„è®¾æ˜¯æ— é™çš„, å¦‚æœæˆ‘ä»¬æŠŠå®ƒç»“æŸ,åŸæœ¬çš„ observable ä¹Ÿä¼šè·Ÿç€ç»“æŸ</p>
</blockquote>
<h3 id="repeat"><a href="#repeat" class="headerlink" title="repeat"></a>repeat</h3><p>repeat çš„è¡Œä¸ºè·Ÿ retry åŸºæœ¬ä¸€è‡´, åªæ˜¯ retry åªæœ‰åœ¨ä¾‹å¤–å‘ç”Ÿæ—¶æ‰è§¦å‘</p>
<h3 id="ä¸€ä¸ªå®ä¾‹"><a href="#ä¸€ä¸ªå®ä¾‹" class="headerlink" title="ä¸€ä¸ªå®ä¾‹:"></a>ä¸€ä¸ªå®ä¾‹:</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é”™è¯¯å¤„ç†</span></span><br><span class="line"><span class="keyword">const</span> title = <span class="built_in">document</span>.getElementById(<span class="string">'title'</span>)</span><br><span class="line"><span class="keyword">const</span> source = Rx.Observable.from([<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="number">2</span>])</span><br><span class="line">			.zip(Rx.Observable.interval(<span class="number">500</span>), (x,y) =&gt; x)</span><br><span class="line">			.map(<span class="function"><span class="params">x</span> =&gt;</span> x.toUpperCase())</span><br><span class="line"><span class="comment">// é€šå¸¸ source ä¼šå»ºç«‹å³æ—¶åŒæ­¥çš„è¿çº¿, åƒæ˜¯ web socket</span></span><br><span class="line"><span class="keyword">const</span> example = source.catch(<span class="function">(<span class="params">err, obs</span>) =&gt;</span> &#123;</span><br><span class="line">    Rx.Observable.empty()</span><br><span class="line">  	.startWith(<span class="string">'è¿çº¿å‘ç”Ÿé”™è¯¯: 5s åé‡è¿'</span>)</span><br><span class="line">  	.concat(obs.delay(<span class="number">5000</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>åˆ©ç”¨ catch è¿”å›ä¸€ä¸ªæ–°çš„ observable, è¿™ä¸ª observable ä¼šå…ˆé€å‡ºé”™è¯¯ä¿¡æ¯, å¹¶ä¸”æŠŠåŸæœ¬çš„ observable å»¶è¿Ÿ5ç§’åœ¨åšåˆå¹¶</p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2017-06-12</span><i class="fa fa-tag"></i><a class="tag" href="/tags/RxJS/" title="RxJS">RxJS </a></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title);}})();" ref="nofollow" target="_blank"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,http://lizimeow.com/2017/06/12/ RxJSå­¦ä¹ -(3)-é”™è¯¯å¤„ç†.1/,lizimeow's blog,RxJS å­¦ä¹ -(3)-é”™è¯¯å¤„ç†,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2017/06/20/ RxJSå­¦ä¹ -(4)-å¤„ç†é«˜é˜¶æµ/" title="RxJS å­¦ä¹ -(4)-å¤„ç†é«˜é˜¶æµ">Post Anterior</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2017/06/10/ RxJSå­¦ä¹ -(2)-åŸºæœ¬çš„ operators (äºŒ)/" title="RxJS å­¦ä¹ -(2)-åŸºæœ¬çš„ operators (äºŒ)">PrÃ³ximo post</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>